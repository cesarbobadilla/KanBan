<body>

    <div class="sidebar d-flex flex-column p-3">
        <!-- Logo Section -->
        <div class="mb-4 text-center">
            <h2 class="text-primary">GesPro</h2>
        </div>


        <!-- Profile Section -->
        <div class="text-center mb-4">
            <p class="fw-bold mb-0">{{ cUsuario }}</p>
            <p class="text-muted small mb-0">{{ cCorreo }}</p>
            <i class="pi pi-chevron-down mt-2"></i> <!-- Icono opcional para desplegar -->
        </div>

        <!-- Menu Section -->
        <ul class="nav flex-column mb-auto">
            <li class="nav-item mb-2">
                <a routerLink="/principal" class="nav-link d-flex align-items-center">
                    <i class="pi pi-home me-2"></i>
                    <span>Inicio</span>
                </a>
            </li>
            <li class="nav-item mb-2">
                <a routerLink="/gestorproyectos" class="nav-link active d-flex align-items-center">
                    <i class="pi pi-briefcase me-2"></i>
                    <span>Proyectos</span>
                </a>
            </li>
            <li class="nav-item mb-2">
                <a routerLink="/gestor" class="nav-link d-flex align-items-center">
                    <i class="pi pi-users me-2"></i>
                    <span>Usuarios</span>
                </a>
            </li>
            <li class="nav-item mb-2">
                <a routerLink="/reportes" class="nav-link d-flex align-items-center">
                    <i class="pi pi-chart-line me-2"></i>
                    <span>Reportes</span>
                </a>
            </li>
        </ul>

        <!-- Bottom Menu Section -->
        <ul class="nav flex-column mt-auto">
            <li class="nav-item mb-2">
                <a routerLink="/ajustes" class="nav-link d-flex align-items-center">
                    <i class="pi pi-cog me-2"></i>
                    <span>Ajustes del sistema</span>
                </a>
            </li>
            <li class="nav-item mb-2">
                <a routerLink="/ayuda" class="nav-link d-flex align-items-center">
                    <i class="pi pi-info-circle me-2"></i>
                    <span>Centro de ayuda</span>
                </a>
            </li>
            <li class="nav-item">
                <a routerLink="/logout" class="nav-link d-flex align-items-center">
                    <i class="pi pi-sign-out me-2"></i>
                    <span>Cerrar sesión</span>
                </a>
            </li>
        </ul>
    </div>

    <div class="content p-4" *ngIf="proyecto">
        <div class="container-fluid">
            <!-- Encabezado del Proyecto -->
            <div class="row mb-4">
                <div class="col">
                    <h1>{{ proyecto.cNombre }}</h1>
                </div>
            </div>

            <div class="row">
                <!-- Columna Izquierda (Datos generales y Estadísticas) -->
                <div class="col-lg-8 mb-4">
                    <!-- Datos Generales -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-between align-items-center">Datos generales
                                <button class="btn btn-outline-primary btn-sm">
                                    <i class="pi pi-pencil"></i>
                                </button>
                            </h5>
                            <hr class="my-3">
                            <p class="card-text"><strong>Descripción:</strong> {{ proyecto.cDescripcion }}</p>
                            <p class="card-text"><strong>Fecha Inicio:</strong> {{ proyecto.tFechaInicio | date }}</p>
                            <p class="card-text"><strong>Fecha Fin:</strong> {{ proyecto.tFechaFin | date }}</p>
                            <p class="card-text"><strong>Estado:</strong> {{ proyecto.bEstado ? 'ACTIVO' : 'TERMINADO'
                                }}</p>
                            <p class="card-text"><strong>Usuario Creación:</strong> {{ cUsuario }}</p>
                        </div>
                    </div>

                    <!-- Estadísticas -->
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Estadísticas</h5>
                            <hr class="my-3">
                            <div class="row text-center">
                                <!-- Avance -->
                                <div class="col">
                                    <p>Avance</p>
                                    <div class="progress-circle">
                                        <span class="percentage-span">68%</span>
                                    </div>
                                    <small class="d-block mt-2">Completado</small>
                                    <small>Pendiente/Retrasado</small>
                                </div>
                                <!-- Entregables -->
                                <div class="col">
                                    <p>Entregables</p>
                                    <div class="progress-circle">
                                        <span class="percentage-span">63%</span>
                                    </div>
                                    <small class="d-block mt-2">Avance</small>
                                </div>
                                <!-- Tareas -->
                                <div class="col">
                                    <p>Tareas</p>
                                    <div class="progress-circle">
                                        <span class="percentage-span">20%</span>
                                    </div>
                                    <small class="d-block mt-2">Avance</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Columna Derecha (Etapas y Usuarios) -->
                <div class="col-lg-4">
                    <!-- Etapas -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-between align-items-center">
                                Etapas
                                <button class="btn btn-outline-primary btn-sm">
                                    <i class="pi pi-plus"></i>
                                </button>
                            </h5>
                            <hr class="my-3">
                            <!-- Lista de Etapas -->
                            <ul class="timeline">
                                <li class="timeline-item" *ngFor="let entregable of entregables">
                                    <input type="radio" name="timeline" [id]="'stage' + entregable.nEntregable"
                                        class="timeline-radio">
                                    <label [for]="'stage' + entregable.nEntregable" class="timeline-icon"></label>
                                    <div class="timeline-content">
                                        <h6>{{ entregable.cNombre }}
                                            <small class="text-muted">del {{ entregable.tFechaInicio | date:'dd/MM/yyyy'
                                                }} al {{ entregable.tFechaFin | date:'dd/MM/yyyy' }}</small>
                                        </h6>
                                        <p>{{ entregable.CantidadTareas }} tareas, {{ entregable.nEntregables }}
                                            entregables</p>
                                    </div>
                                </li>
                            </ul>

                        </div>
                    </div>

                    <!-- Usuarios -->
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-between align-items-center">Usuarios
                                <button class="btn btn-outline-primary btn-sm" (click)="showDialog()">
                                    <i class="pi pi-plus"></i>
                                </button>
                            </h5>
                            <hr class="my-3">

                            <!-- Lista de Usuarios -->
                            <ul class="list-unstyled">
                                <li class="d-flex align-items-center mb-3" *ngFor="let usuario of usuarios">
                                    <div>
                                        <strong>{{ usuario.cUsuario }}</strong>
                                        <small class="text-muted">({{ usuario.cNombre }})</small><br>
                                        <small class="text-muted">{{ usuario.cCorreo }}</small>
                                    </div>
                                </li>
                            </ul>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- p-dialog para seleccionar usuario y rol -->
    <p-dialog header="Asignar Usuario y Rol" [(visible)]="displayDialog" [modal]="true" [closable]="true">
        <div class="p-fluid">
            <!-- Selector de usuarios -->
            <div class="form-group">
                <label for="usuario">Usuario</label>
                <select id="usuario" [(ngModel)]="selectedUsuario" name="usuario" class="form-select">
                    <option *ngFor="let usuario of datosUsuarios" [value]="usuario.nUsuario">{{ usuario.cUsuario}}</option>
                </select>
            </div>

            <!-- Selector de roles -->
            <div class="form-group">
                <label for="rol">Rol</label>
                <select id="rol" [(ngModel)]="selectedRol" name="rol" class="form-select">
                    <option value="3">Lider</option>
                    <option value="4">Estudiante</option>
                </select>
            </div>
        </div>
        <p-footer>
            <button type="button" pButton label="Guardar" (click)="save()"></button>
            <button type="button" pButton label="Cancelar" (click)="hideDialog()"></button>
        </p-footer>
    </p-dialog>
    <!-- Incluir Bootstrap JS (opcional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // JavaScript para actualizar el progreso dinámicamente
        document.querySelectorAll('.progress-circle').forEach(circle => {
            const percentageSpan = circle.querySelector('.percentage-span');
            const percentage = parseInt(percentageSpan.textContent);
            circle.style.setProperty('--percentage', percentage);
        });
    </script>
</body>